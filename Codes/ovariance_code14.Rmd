---
title: "Stability selection for censored biomedical and bioinformatics data"
author: "Yunwei Zhang"
date: “`r paste0('Initiated on 20231108, compiled on ', format(Sys.time(), '%Y %b %d'))`”
output:
  
  html_document:
    code_folding: hide
    fig_height: 8
    fig_width: 12
    highlight: tango
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: no
  pdf_document:
    toc: yes
    toc_depth: '4'
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE)
#usethis::edit_r_environ()
#R_MAX_VSIZE=700Gb
```

This file is to get results from the ovarian cancer data (redo) to double check what I have concluded.
Run resutls were taken from code 11.
```{r}
.libPaths("/dskh/nobackup/yunwei/stability_selection_codes/stability_selection_library")
setwd("/dskh/nobackup/yunwei/stability_selection_codes")
library(inline)
openblas.set.num.threads <- cfunction( signature(ipt="integer"),
                                       body = "openblas_set_num_threads(*ipt);",
                                       otherdefs = c ("extern void openblas_set_num_threads(int);"),
                                       libargs = c ("/usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3"),
                                       language = "C",
                                       convention = ".C"
)
openblas.set.num.threads(1)

#install.packages("Matrix")
#library(Matrix)
library(survAUC)
library(reshape2)
library(ggplot2)
library(readxl)
library(ggpubr)
library(dplyr)
library(tidyverse)
library(mstate)
library(MASS)
library(survival)
library(MatchIt)
library(mice)
library(DT)
library(EnvStats)
library(pbmcapply)
library(FNN)

library(pec)
library(MultiAssayExperiment)
library(TCGAbiolinks)

library(survivalROC)
library(survival)
#library(CoxBoost) #archrived package
library(limma)
library(survivalsvm)
library(survminer)
library(randomForestSRC)
library(glmnet)
library(rms)
library(penalized)
library(riskRegression)
library(pROC)
library(ROCR)
library(cvTools)
library(parallel)
library(MTLR)
library(icenReg)#was trying to get data (miceData), however, there is no covariates with that interval censored data
library(mcsurvdata)
library(ExperimentHub)
library(hdnom)
library(Hmisc)
library(ggrepel)
```


```{r}
current_data=read.csv("GSE49997_eset_processed.csv")
current_data2=current_data[,-which(colnames(current_data)=="os_class")]
dim(current_data)
dim(current_data2)
set.seed(230720)
rownum=sample(nrow(current_data2),nrow(current_data2)*0.2,replace = FALSE)
ex_validation=current_data2[rownum,]
current_data2=current_data2[-rownum,]
dim(ex_validation)#38
dim(current_data2)#156
```

```{r}
#check the with replacement percentage of unique observations compared with the without
check_percentage=function(data,m_percentage){
  set.seed(20230824)
  i=1
  updated_data1=moutofn_bootstrap_fun(data,i,m_percentage)
  updated_data2=moutofn_bootstrap_fun_wr(data,i,m_percentage)
  sample1_tr=dim(as.data.frame(updated_data1[[1]])%>% distinct())[1]
  sample1_te=dim(as.data.frame(updated_data1[[2]])%>% distinct())[1]
  sample2_tr=dim(as.data.frame(updated_data2[[1]])%>% distinct())[1]
  sample2_te=dim(as.data.frame(updated_data2[[2]])%>% distinct())[1]
  return(c(sample1_tr,sample1_te,sample2_tr,sample2_te))
}

plotdt=cbind.data.frame(c("0.1_tr_without","0.1_tr_with","0.2_tr_without","0.2_tr_with","0.3_tr_without","0.3_tr_with","0.4_tr_without","0.4_tr_with","0.5_tr_without","0.5_tr_with","0.6_tr_without","0.6_tr_with","0.7_tr_without","0.7_tr_with","0.8_tr_without","0.8_tr_with","0.9_tr_without","0.9_tr_with","100%_tr_without","100%_tr_with"),c(check_percentage(current_data2,0.1)[c(1,3)],check_percentage(current_data2,0.2)[c(1,3)],check_percentage(current_data2,0.3)[c(1,3)],check_percentage(current_data2,0.4)[c(1,3)],check_percentage(current_data2,0.5)[c(1,3)],check_percentage(current_data2,0.6)[c(1,3)],check_percentage(current_data2,0.7)[c(1,3)],check_percentage(current_data2,0.8)[c(1,3)],check_percentage(current_data2,0.9)[c(1,3)],check_percentage(current_data2,1)[c(1,3)]),c(rep(c("without","with"),10)))
colnames(plotdt)=c("sampling_technique_names","unique_observations","replacement_no_yes")
plotdt$sampling_technique_names=sapply(strsplit(plotdt$sampling_technique_names,"_"), '[', 1)
#reshape(plotdt, idvar = "sampling_technique_names", timevar = "replacement_no_yes", direction = "wide")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=unique_observations,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ylim(c(0,dim(current_data2)[1]))+geom_line()
gg
ggplot1=gg
#ggsave("sampling_percentage_train_ovarian.pdf",gg,width = 8,height = 5)
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=unique_observations,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ylim(c(0,dim(current_data2)[1]))+geom_line()
gg
#ggsave("sampling_percentage_train_ovarian2.pdf",gg,width = 8,height = 5)
ggplot2=gg


load("lasso_ovarian_check_without.RData")


other_table=function(result,data){
  censoring_rate=c()
  cindex=c()
  num_variables=c()
  brier_score=c()
  auc=c()
  distance_stat=c()
  distance_p=c()
  
  censoring_rate_test=c()
  distance_stat_test=c()
  distance_p_test=c()
  
  lambda=c()
  npasses=c()
  devratio=c()
  
  cindex_train=c()
  brier_score_train=c()
  
  cindex_ex=c()
  brier_score_ex=c()
  auc_ex=c()
  
  # auc_all_test=list()
  # auc_all_ex=list()
  for(i in 1:length(result)){
    if(length(result[[i]])>1){
    censoring_rate[i]=result[[i]][[1]]
    cindex[i]=result[[i]][[3]]
    num_variables[i]=result[[i]][[4]]/dim(data)[2]
    brier_score[i]=result[[i]][[5]]
    auc[i]=result[[i]][[6]]
    distance_stat[i]=result[[i]][[8]]$statistic
    distance_p[i]=result[[i]][[8]]$p.value
    
    censoring_rate_test[i]=result[[i]][[7]]
    distance_stat_test[i]=result[[i]][[9]]$statistic
    distance_p_test[i]=result[[i]][[9]]$p.value
    lambda[i]=result[[i]][[10]]
    npasses[i]=result[[i]][[11]]
    devratio[i]=result[[i]][[12]]
    
    cindex_train[i]=result[[i]][[13]]
    brier_score_train[i]=result[[i]][[14]]
    
    cindex_ex[i]=result[[i]][[15]]
    brier_score_ex[i]=result[[i]][[16]]
    auc_ex[i]=result[[i]][[17]]
    
    # auc_all_test[[i]]=result[[i]][[18]]
    # auc_all_ex[[i]]=result[[i]][[19]]
    
    }else{
    censoring_rate[i]=NA
    cindex[i]=NA
    num_variables[i]=NA
    brier_score[i]=NA
    auc[i]=NA
    distance_stat[i]=NA
    distance_p[i]=NA
    censoring_rate_test[i]=NA
  distance_stat_test[i]=NA
  distance_p_test[i]=NA
  lambda[i]=NA
  npasses[i]=NA
  devratio[i]=NA
  cindex_train[i]=NA
  brier_score_train[i]=NA
  cindex_ex[i]=NA
  brier_score_ex[i]=NA
  auc_ex[i]=NA
  
  # auc_all_test[[i]]=NA
  # auc_all_ex[[i]]=NA
  }}
  return(c(mean(censoring_rate,na.rm=TRUE),mean(num_variables,na.rm=TRUE),mean(cindex,na.rm=TRUE),mean(auc,na.rm=TRUE),mean(brier_score,na.rm=TRUE),mean(distance_stat,na.rm=TRUE),mean(distance_p,na.rm=TRUE),mean(censoring_rate_test,na.rm=TRUE),mean(distance_stat_test,na.rm=TRUE),mean(distance_p_test,na.rm=TRUE),mean(lambda,na.rm=TRUE),mean(npasses,na.rm=TRUE),mean(devratio,na.rm=TRUE),mean(cindex_train,na.rm=TRUE),mean(brier_score_train,na.rm=TRUE),mean(cindex_ex,na.rm=TRUE),mean(brier_score_ex,na.rm=TRUE),mean(auc_ex,na.rm=TRUE)))
}

heatmap_data=data.frame(nrow=18*18,ncol=18)
heatmap_data[1:324,1]=rep(c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9","m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr"),each=18)
heatmap_data[1:324,2]=rep(c("censoring_rate","num_variables","cindex","auc","brier_score","distance_stat","distance_p","censoring_rate_test","distance_stat_test","distance_p_test","lambda","npasses","devratio","cindex_train","brier_score_train","cindex_ex","brier_score_ex","auc_ex"),18)
heatmap_data[1:324,3]=c(other_table(result1,current_data2),other_table(result2,current_data2),other_table(result3,current_data2),other_table(result4,current_data2),other_table(result5,current_data2),other_table(result6,current_data2),other_table(result7,current_data2),other_table(result8,current_data2),other_table(result9,current_data2),other_table(result11,current_data2),other_table(result12,current_data2),other_table(result13,current_data2),other_table(result14,current_data2),other_table(result15,current_data2),other_table(result16,current_data2),other_table(result17,current_data2),other_table(result18,current_data2),other_table(result19,current_data2))
colnames(heatmap_data)=c("case","metric","value")
heatmap_data$metric=factor(heatmap_data$metric,levels = c("censoring_rate","num_variables","cindex","auc","brier_score","distance_stat","distance_p","censoring_rate_test","distance_stat_test","distance_p_test","lambda","npasses","devratio","cindex_train","brier_score_train","cindex_ex","brier_score_ex","auc_ex"))

ovarian_result=heatmap_data

load("lasso_ovarian_check_with500.RData")


other_table=function(result,data){
  censoring_rate=c()
  cindex=c()
  num_variables=c()
  brier_score=c()
  auc=c()
  distance_stat=c()
  distance_p=c()
  
  censoring_rate_test=c()
  distance_stat_test=c()
  distance_p_test=c()
  
  lambda=c()
  npasses=c()
  devratio=c()
  
  cindex_train=c()
  brier_score_train=c()
  
  cindex_ex=c()
  brier_score_ex=c()
  auc_ex=c()
  
  # auc_all_test=list()
  # auc_all_ex=list()
  for(i in 1:length(result)){
    if(length(result[[i]])>1){
    censoring_rate[i]=result[[i]][[1]]
    cindex[i]=result[[i]][[3]]
    num_variables[i]=result[[i]][[4]]/dim(data)[2]
    brier_score[i]=result[[i]][[5]]
    auc[i]=result[[i]][[6]]
    distance_stat[i]=result[[i]][[8]]$statistic
    distance_p[i]=result[[i]][[8]]$p.value
    
    censoring_rate_test[i]=result[[i]][[7]]
    distance_stat_test[i]=result[[i]][[9]]$statistic
    distance_p_test[i]=result[[i]][[9]]$p.value
    lambda[i]=result[[i]][[10]]
    npasses[i]=result[[i]][[11]]
    devratio[i]=result[[i]][[12]]
    
    cindex_train[i]=result[[i]][[13]]
    brier_score_train[i]=result[[i]][[14]]
    
    cindex_ex[i]=result[[i]][[15]]
    brier_score_ex[i]=result[[i]][[16]]
    auc_ex[i]=result[[i]][[17]]
    
    # auc_all_test[[i]]=result[[i]][[18]]
    # auc_all_ex[[i]]=result[[i]][[19]]
    
    }else{
    censoring_rate[i]=NA
    cindex[i]=NA
    num_variables[i]=NA
    brier_score[i]=NA
    auc[i]=NA
    distance_stat[i]=NA
    distance_p[i]=NA
    censoring_rate_test[i]=NA
  distance_stat_test[i]=NA
  distance_p_test[i]=NA
  lambda[i]=NA
  npasses[i]=NA
  devratio[i]=NA
  cindex_train[i]=NA
  brier_score_train[i]=NA
  cindex_ex[i]=NA
  brier_score_ex[i]=NA
  auc_ex[i]=NA
  
  # auc_all_test[[i]]=NA
  # auc_all_ex[[i]]=NA
  }}
  return(c(mean(censoring_rate,na.rm=TRUE),mean(num_variables,na.rm=TRUE),mean(cindex,na.rm=TRUE),mean(auc,na.rm=TRUE),mean(brier_score,na.rm=TRUE),mean(distance_stat,na.rm=TRUE),mean(distance_p,na.rm=TRUE),mean(censoring_rate_test,na.rm=TRUE),mean(distance_stat_test,na.rm=TRUE),mean(distance_p_test,na.rm=TRUE),mean(lambda,na.rm=TRUE),mean(npasses,na.rm=TRUE),mean(devratio,na.rm=TRUE),mean(cindex_train,na.rm=TRUE),mean(brier_score_train,na.rm=TRUE),mean(cindex_ex,na.rm=TRUE),mean(brier_score_ex,na.rm=TRUE),mean(auc_ex,na.rm=TRUE)))
}

heatmap_data=data.frame(nrow=18*18,ncol=18)
heatmap_data[1:324,1]=rep(c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9","m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr"),each=18)
heatmap_data[1:324,2]=rep(c("censoring_rate","num_variables","cindex","auc","brier_score","distance_stat","distance_p","censoring_rate_test","distance_stat_test","distance_p_test","lambda","npasses","devratio","cindex_train","brier_score_train","cindex_ex","brier_score_ex","auc_ex"),18)
heatmap_data[1:324,3]=c(other_table(result1,current_data2),other_table(result2,current_data2),other_table(result3,current_data2),other_table(result4,current_data2),other_table(result5,current_data2),other_table(result6,current_data2),other_table(result7,current_data2),other_table(result8,current_data2),other_table(result9,current_data2),other_table(result11,current_data2),other_table(result12,current_data2),other_table(result13,current_data2),other_table(result14,current_data2),other_table(result15,current_data2),other_table(result16,current_data2),other_table(result17,current_data2),other_table(result18,current_data2),other_table(result19,current_data2))
colnames(heatmap_data)=c("case","metric","value")
heatmap_data$metric=factor(heatmap_data$metric,levels = c("censoring_rate","num_variables","cindex","auc","brier_score","distance_stat","distance_p","censoring_rate_test","distance_stat_test","distance_p_test","lambda","npasses","devratio","cindex_train","brier_score_train","cindex_ex","brier_score_ex","auc_ex"))

ovarian_c_result=heatmap_data


```

# without control
```{r}
result=ovarian_result[1:(18*9),]
r_result=ovarian_result[(18*9+1):dim(ovarian_result)[1],]
plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex","value"],r_result[r_result$metric=="cindex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing C-index")
# dt1=plotdt[plotdt$replacement_no_yes=="without",]
# dt2=plotdt[plotdt$replacement_no_yes=="with",]
# ggplot() +
#   geom_point(data = dt1, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_point(data = dt2, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_curve()  +
#   labs(title = "Connecting two groups of points with curves") +
#   theme_minimal()
ggplot3=gg


plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_train","value"],r_result[r_result$metric=="cindex_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training C-index")
ggplot4=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_ex","value"],r_result[r_result$metric=="cindex_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data C-index")
ggplot5=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score","value"],r_result[r_result$metric=="brier_score","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing Brier Score")
ggplot6=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_train","value"],r_result[r_result$metric=="brier_score_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training Brier Score")
ggplot7=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_ex","value"],r_result[r_result$metric=="brier_score_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data Brier Score")
ggplot8=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate","value"],r_result[r_result$metric=="censoring_rate","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training censoring rate")
ggplot9=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate_test","value"],r_result[r_result$metric=="censoring_rate_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing censoring rate")
ggplot10=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat","value"],r_result[r_result$metric=="distance_stat","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training distance statistics")
ggplot11=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat_test","value"],r_result[r_result$metric=="distance_stat_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing distance statistics")
ggplot12=gg

finalgg=ggarrange(ggplot1,ggplot2,ggplot3,ggplot4,ggplot5,ggplot6,ggplot7,ggplot8,ggplot9,ggplot10,ggplot11,ggplot12,nrow=4,ncol = 3)
ggsave("ovarian_all.pdf",finalgg,width=20,height = 20)
```


# with control
```{r}
result=ovarian_c_result[1:(18*9),]
r_result=ovarian_c_result[(18*9+1):dim(ovarian_c_result)[1],]
plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex","value"],r_result[r_result$metric=="cindex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing C-index")
# dt1=plotdt[plotdt$replacement_no_yes=="without",]
# dt2=plotdt[plotdt$replacement_no_yes=="with",]
# ggplot() +
#   geom_point(data = dt1, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_point(data = dt2, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_curve()  +
#   labs(title = "Connecting two groups of points with curves") +
#   theme_minimal()
ggplot3=gg


plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_train","value"],r_result[r_result$metric=="cindex_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training C-index")
ggplot4=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_ex","value"],r_result[r_result$metric=="cindex_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data C-index")
ggplot5=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score","value"],r_result[r_result$metric=="brier_score","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing Brier Score")
ggplot6=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_train","value"],r_result[r_result$metric=="brier_score_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training Brier Score")
ggplot7=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_ex","value"],r_result[r_result$metric=="brier_score_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data Brier Score")
ggplot8=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate","value"],r_result[r_result$metric=="censoring_rate","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training censoring rate")
ggplot9=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate_test","value"],r_result[r_result$metric=="censoring_rate_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing censoring rate")
ggplot10=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat","value"],r_result[r_result$metric=="distance_stat","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training distance statistics")
ggplot11=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat_test","value"],r_result[r_result$metric=="distance_stat_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing distance statistics")
ggplot12=gg

finalgg=ggarrange(ggplot1,ggplot2,ggplot3,ggplot4,ggplot5,ggplot6,ggplot7,ggplot8,ggplot9,ggplot10,ggplot11,ggplot12,nrow=4,ncol = 3)
ggsave("ovarian_control_all.pdf",finalgg,width=20,height = 20)

```

save all organised with the same scale.
```{r}
result=ovarian_result[1:(18*9),]
r_result=ovarian_result[(18*9+1):dim(ovarian_result)[1],]
plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex","value"],r_result[r_result$metric=="cindex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing C-index")+ylim(c(0.8,1))
# dt1=plotdt[plotdt$replacement_no_yes=="without",]
# dt2=plotdt[plotdt$replacement_no_yes=="with",]
# ggplot() +
#   geom_point(data = dt1, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_point(data = dt2, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_curve()  +
#   labs(title = "Connecting two groups of points with curves") +
#   theme_minimal()
gg3=gg


plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_train","value"],r_result[r_result$metric=="cindex_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training C-index")+ylim(c(0.3,1))
gg1=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_ex","value"],r_result[r_result$metric=="cindex_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data C-index")
ggplot5=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score","value"],r_result[r_result$metric=="brier_score","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing Brier Score")+ylim(c(0.2,0.85))
gg7=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_train","value"],r_result[r_result$metric=="brier_score_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training Brier Score")+ylim(c(0.4,0.6))
gg5=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_ex","value"],r_result[r_result$metric=="brier_score_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data Brier Score")
ggplot8=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate","value"],r_result[r_result$metric=="censoring_rate","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training censoring rate")+ylim(c(0.68,0.76))
gg9=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate_test","value"],r_result[r_result$metric=="censoring_rate_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing censoring rate")+ylim(c(0.69,0.71))
gg11=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat","value"],r_result[r_result$metric=="distance_stat","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training distance statistics")+ylim(c(0,0.2))
gg13=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat_test","value"],r_result[r_result$metric=="distance_stat_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing distance statistics")+ylim(c(0,0.2))
gg15=gg

result=ovarian_c_result[1:(18*9),]
r_result=ovarian_c_result[(18*9+1):dim(ovarian_c_result)[1],]
plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex","value"],r_result[r_result$metric=="cindex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing C-index")+ylim(c(0.8,1))
# dt1=plotdt[plotdt$replacement_no_yes=="without",]
# dt2=plotdt[plotdt$replacement_no_yes=="with",]
# ggplot() +
#   geom_point(data = dt1, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_point(data = dt2, aes(x = sampling_technique_names, y = C_index, color = replacement_no_yes)) +
#   geom_curve()  +
#   labs(title = "Connecting two groups of points with curves") +
#   theme_minimal()
gg4=gg


plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_train","value"],r_result[r_result$metric=="cindex_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training C-index")+ylim(c(0.3,1))
gg2=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="cindex_ex","value"],r_result[r_result$metric=="cindex_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","cindex_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=cindex_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data C-index")
ggplot5=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score","value"],r_result[r_result$metric=="brier_score","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing Brier Score")+ylim(c(0.2,0.85))
gg8=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_train","value"],r_result[r_result$metric=="brier_score_train","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_train","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_train,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training Brier Score")+ylim(c(0.4,0.6))
gg6=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="brier_score_ex","value"],r_result[r_result$metric=="brier_score_ex","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","brier_score_ex","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=brier_score_ex,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("External validation data Brier Score")
ggplot8=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate","value"],r_result[r_result$metric=="censoring_rate","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training censoring rate")+ylim(c(0.68,0.76))
gg10=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="censoring_rate_test","value"],r_result[r_result$metric=="censoring_rate_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","censoring_rate_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=censoring_rate_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing censoring rate")+ylim(c(0.69,0.71))
gg12=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat","value"],r_result[r_result$metric=="distance_stat","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Training distance statistics")+ylim(c(0,0.2))
gg14=gg

plotdt=cbind.data.frame(c(c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9"),c("0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9")),c(result[result$metric=="distance_stat_test","value"],r_result[r_result$metric=="distance_stat_test","value"]),c(rep("without",9),rep("with",9)))
colnames(plotdt)=c("sampling_technique_names","distance_stat_test","replacement_no_yes")
gg=ggplot(plotdt,aes(x=sampling_technique_names,y=distance_stat_test,color=replacement_no_yes,group=replacement_no_yes))+geom_point()+ theme_bw()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_line()+ggtitle("Testing distance statistics")+ylim(c(0,0.2))
gg16=gg

finalgg=ggarrange(gg1,gg2,gg3,gg4,gg5,gg6,gg7,gg8,gg9,gg10,gg11,gg12,gg13,gg14,gg15,gg16,nrow=4,ncol = 4)
ggsave("ovarian_arranged.pdf",finalgg,width=25,height = 20)
```

perform pairwise tests (need all values, not just the mean)
```{r}
all_train_cindex_fun=function(result){
  all_train_cindex=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_train_cindex[i]=0}else{all_train_cindex[i]=result[[i]][[13]]}
}
return(all_train_cindex)}

all_train_bs_fun=function(result){
  all_train_bs=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_train_bs[i]=0}else{all_train_bs[i]=result[[i]][[14]]}
}
return(all_train_bs)}

all_train_distance_fun=function(result){
  all_train_distance=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_train_distance[i]=0}else{all_train_distance[i]=result[[i]][[8]]$statistic}
}
return(all_train_distance)}

all_train_cr_fun=function(result){
  all_train_cr=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_train_cr[i]=0}else{all_train_cr[i]=result[[i]][[1]]}
}
return(all_train_cr)}

#in test
all_test_cindex_fun=function(result){
  all_test_cindex=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_test_cindex[i]=0}else{all_test_cindex[i]=result[[i]][[3]]}
}
return(all_test_cindex)}

all_test_bs_fun=function(result){
  all_test_bs=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_test_bs[i]=0}else{all_test_bs[i]=result[[i]][[5]]}
}
return(all_test_bs)}

all_test_distance_fun=function(result){
  all_test_distance=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_test_distance[i]=0}else{all_test_distance[i]=result[[i]][[9]]$statistic}
}
return(all_test_distance)}

all_test_cr_fun=function(result){
  all_test_cr=c()
for(i in 1:length(result)){
  if(length(result[[i]])==1){all_test_cr[i]=0}else{all_test_cr[i]=result[[i]][[7]]}
}
return(all_test_cr)}

load("lasso_ovarian_check_without.RData")
lasso_train_cindex_all=c(all_train_cindex_fun(result1),all_train_cindex_fun(result2),all_train_cindex_fun(result3),all_train_cindex_fun(result4),all_train_cindex_fun(result5),all_train_cindex_fun(result6),all_train_cindex_fun(result7),all_train_cindex_fun(result8),all_train_cindex_fun(result9),all_train_cindex_fun(result11),all_train_cindex_fun(result12),all_train_cindex_fun(result13),all_train_cindex_fun(result14),all_train_cindex_fun(result15),all_train_cindex_fun(result16),all_train_cindex_fun(result17),all_train_cindex_fun(result18),all_train_cindex_fun(result19))
lasso_train_distance_all=c(all_train_distance_fun(result1),all_train_distance_fun(result2),all_train_distance_fun(result3),all_train_distance_fun(result4),all_train_distance_fun(result5),all_train_distance_fun(result6),all_train_distance_fun(result7),all_train_distance_fun(result8),all_train_distance_fun(result9),all_train_distance_fun(result11),all_train_distance_fun(result12),all_train_distance_fun(result13),all_train_distance_fun(result14),all_train_distance_fun(result15),all_train_distance_fun(result16),all_train_distance_fun(result17),all_train_distance_fun(result18),all_train_distance_fun(result19))
lasso_train_cr_all=c(all_train_cr_fun(result1),all_train_cr_fun(result2),all_train_cr_fun(result3),all_train_cr_fun(result4),all_train_cr_fun(result5),all_train_cr_fun(result6),all_train_cr_fun(result7),all_train_cr_fun(result8),all_train_cr_fun(result9),all_train_cr_fun(result11),all_train_cr_fun(result12),all_train_cr_fun(result13),all_train_cr_fun(result14),all_train_cr_fun(result15),all_train_cr_fun(result16),all_train_cr_fun(result17),all_train_cr_fun(result18),all_train_cr_fun(result19))
lasso_train_bs_all=c(all_train_bs_fun(result1),all_train_bs_fun(result2),all_train_bs_fun(result3),all_train_bs_fun(result4),all_train_bs_fun(result5),all_train_bs_fun(result6),all_train_bs_fun(result7),all_train_bs_fun(result8),all_train_bs_fun(result9),all_train_bs_fun(result11),all_train_bs_fun(result12),all_train_bs_fun(result13),all_train_bs_fun(result14),all_train_bs_fun(result15),all_train_bs_fun(result16),all_train_bs_fun(result17),all_train_bs_fun(result18),all_train_bs_fun(result19))

#in test
lasso_test_cindex_all=c(all_test_cindex_fun(result1),all_test_cindex_fun(result2),all_test_cindex_fun(result3),all_test_cindex_fun(result4),all_test_cindex_fun(result5),all_test_cindex_fun(result6),all_test_cindex_fun(result7),all_test_cindex_fun(result8),all_test_cindex_fun(result9),all_test_cindex_fun(result11),all_test_cindex_fun(result12),all_test_cindex_fun(result13),all_test_cindex_fun(result14),all_test_cindex_fun(result15),all_test_cindex_fun(result16),all_test_cindex_fun(result17),all_test_cindex_fun(result18),all_test_cindex_fun(result19))
lasso_test_distance_all=c(all_test_distance_fun(result1),all_test_distance_fun(result2),all_test_distance_fun(result3),all_test_distance_fun(result4),all_test_distance_fun(result5),all_test_distance_fun(result6),all_test_distance_fun(result7),all_test_distance_fun(result8),all_test_distance_fun(result9),all_test_distance_fun(result11),all_test_distance_fun(result12),all_test_distance_fun(result13),all_test_distance_fun(result14),all_test_distance_fun(result15),all_test_distance_fun(result16),all_test_distance_fun(result17),all_test_distance_fun(result18),all_test_distance_fun(result19))
lasso_test_cr_all=c(all_test_cr_fun(result1),all_test_cr_fun(result2),all_test_cr_fun(result3),all_test_cr_fun(result4),all_test_cr_fun(result5),all_test_cr_fun(result6),all_test_cr_fun(result7),all_test_cr_fun(result8),all_test_cr_fun(result9),all_test_cr_fun(result11),all_test_cr_fun(result12),all_test_cr_fun(result13),all_test_cr_fun(result14),all_test_cr_fun(result15),all_test_cr_fun(result16),all_test_cr_fun(result17),all_test_cr_fun(result18),all_test_cr_fun(result19))
lasso_test_bs_all=c(all_test_bs_fun(result1),all_test_bs_fun(result2),all_test_bs_fun(result3),all_test_bs_fun(result4),all_test_bs_fun(result5),all_test_bs_fun(result6),all_test_bs_fun(result7),all_test_bs_fun(result8),all_test_bs_fun(result9),all_test_bs_fun(result11),all_test_bs_fun(result12),all_test_bs_fun(result13),all_test_bs_fun(result14),all_test_bs_fun(result15),all_test_bs_fun(result16),all_test_bs_fun(result17),all_test_bs_fun(result18),all_test_bs_fun(result19))

dd=cbind.data.frame(lasso_test_cindex_all,lasso_test_distance_all,lasso_test_cr_all,lasso_test_bs_all)
dd$label=factor(rep(c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9","m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr"),each=100),levels=c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9","m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr"))
dim(dd)
dd_1=dd[which(dd$label%in%c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9")),]
dd_1=dd_1[-which(dd_1$lasso_test_cindex_all==0),]
dd_r=dd[which(dd$label%in%c("m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr")),]
dd_r=dd_r[-which(dd_r$lasso_test_cindex_all==0),]

load("lasso_ovarian_check_with500.RData")
lasso_train_cindex_all=c(all_train_cindex_fun(result1),all_train_cindex_fun(result2),all_train_cindex_fun(result3),all_train_cindex_fun(result4),all_train_cindex_fun(result5),all_train_cindex_fun(result6),all_train_cindex_fun(result7),all_train_cindex_fun(result8),all_train_cindex_fun(result9),all_train_cindex_fun(result11),all_train_cindex_fun(result12),all_train_cindex_fun(result13),all_train_cindex_fun(result14),all_train_cindex_fun(result15),all_train_cindex_fun(result16),all_train_cindex_fun(result17),all_train_cindex_fun(result18),all_train_cindex_fun(result19))
lasso_train_distance_all=c(all_train_distance_fun(result1),all_train_distance_fun(result2),all_train_distance_fun(result3),all_train_distance_fun(result4),all_train_distance_fun(result5),all_train_distance_fun(result6),all_train_distance_fun(result7),all_train_distance_fun(result8),all_train_distance_fun(result9),all_train_distance_fun(result11),all_train_distance_fun(result12),all_train_distance_fun(result13),all_train_distance_fun(result14),all_train_distance_fun(result15),all_train_distance_fun(result16),all_train_distance_fun(result17),all_train_distance_fun(result18),all_train_distance_fun(result19))
lasso_train_cr_all=c(all_train_cr_fun(result1),all_train_cr_fun(result2),all_train_cr_fun(result3),all_train_cr_fun(result4),all_train_cr_fun(result5),all_train_cr_fun(result6),all_train_cr_fun(result7),all_train_cr_fun(result8),all_train_cr_fun(result9),all_train_cr_fun(result11),all_train_cr_fun(result12),all_train_cr_fun(result13),all_train_cr_fun(result14),all_train_cr_fun(result15),all_train_cr_fun(result16),all_train_cr_fun(result17),all_train_cr_fun(result18),all_train_cr_fun(result19))
lasso_train_bs_all=c(all_train_bs_fun(result1),all_train_bs_fun(result2),all_train_bs_fun(result3),all_train_bs_fun(result4),all_train_bs_fun(result5),all_train_bs_fun(result6),all_train_bs_fun(result7),all_train_bs_fun(result8),all_train_bs_fun(result9),all_train_bs_fun(result11),all_train_bs_fun(result12),all_train_bs_fun(result13),all_train_bs_fun(result14),all_train_bs_fun(result15),all_train_bs_fun(result16),all_train_bs_fun(result17),all_train_bs_fun(result18),all_train_bs_fun(result19))

#in test
lasso_test_cindex_all=c(all_test_cindex_fun(result1),all_test_cindex_fun(result2),all_test_cindex_fun(result3),all_test_cindex_fun(result4),all_test_cindex_fun(result5),all_test_cindex_fun(result6),all_test_cindex_fun(result7),all_test_cindex_fun(result8),all_test_cindex_fun(result9),all_test_cindex_fun(result11),all_test_cindex_fun(result12),all_test_cindex_fun(result13),all_test_cindex_fun(result14),all_test_cindex_fun(result15),all_test_cindex_fun(result16),all_test_cindex_fun(result17),all_test_cindex_fun(result18),all_test_cindex_fun(result19))
lasso_test_distance_all=c(all_test_distance_fun(result1),all_test_distance_fun(result2),all_test_distance_fun(result3),all_test_distance_fun(result4),all_test_distance_fun(result5),all_test_distance_fun(result6),all_test_distance_fun(result7),all_test_distance_fun(result8),all_test_distance_fun(result9),all_test_distance_fun(result11),all_test_distance_fun(result12),all_test_distance_fun(result13),all_test_distance_fun(result14),all_test_distance_fun(result15),all_test_distance_fun(result16),all_test_distance_fun(result17),all_test_distance_fun(result18),all_test_distance_fun(result19))
lasso_test_cr_all=c(all_test_cr_fun(result1),all_test_cr_fun(result2),all_test_cr_fun(result3),all_test_cr_fun(result4),all_test_cr_fun(result5),all_test_cr_fun(result6),all_test_cr_fun(result7),all_test_cr_fun(result8),all_test_cr_fun(result9),all_test_cr_fun(result11),all_test_cr_fun(result12),all_test_cr_fun(result13),all_test_cr_fun(result14),all_test_cr_fun(result15),all_test_cr_fun(result16),all_test_cr_fun(result17),all_test_cr_fun(result18),all_test_cr_fun(result19))
lasso_test_bs_all=c(all_test_bs_fun(result1),all_test_bs_fun(result2),all_test_bs_fun(result3),all_test_bs_fun(result4),all_test_bs_fun(result5),all_test_bs_fun(result6),all_test_bs_fun(result7),all_test_bs_fun(result8),all_test_bs_fun(result9),all_test_bs_fun(result11),all_test_bs_fun(result12),all_test_bs_fun(result13),all_test_bs_fun(result14),all_test_bs_fun(result15),all_test_bs_fun(result16),all_test_bs_fun(result17),all_test_bs_fun(result18),all_test_bs_fun(result19))

dd=cbind.data.frame(lasso_test_cindex_all,lasso_test_distance_all,lasso_test_cr_all,lasso_test_bs_all)
dd$label=factor(rep(c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9","m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr"),each=500),levels=c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9","m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr"))
dim(dd)
dd_c=dd[which(dd$label%in%c("m0.1","m0.2","m0.3","m0.4","m0.5","m0.6","m0.7","m0.8","m0.9")),]
dd_c=dd_c[-which(dd$lasso_test_cindex_all==0),]
dd_cr=dd[which(dd$label%in%c("m0.1wr","m0.2wr","m0.3wr","m0.4wr","m0.5wr","m0.6wr","m0.7wr","m0.8wr","m0.9wr")),]
dd_cr=dd_cr[-which(dd_cr$lasso_test_cindex_all==0),]
```

```{r}
dt=rbind.data.frame(dd_1,dd_r,dd_c,dd_cr)
dt$group=c(rep("1",nrow(dd_1)),rep("with_replacement",nrow(dd_r)),rep("with_control",nrow(dd_c)),rep("with_controlandreplacement",nrow(dd_cr)))

test_dt=dt[dt$group%in%c("1"),]
wilcox_results <- pairwise.wilcox.test(test_dt$lasso_test_cindex_all, test_dt$label, p.adjust.method = "BH",na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
wilcox_results

test_dt=dt[dt$group%in%c("with_replacement"),]
wilcox_results <- pairwise.wilcox.test(test_dt$lasso_test_cindex_all, test_dt$label, p.adjust.method = "BH",na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
wilcox_results

test_dt=dt[dt$group%in%c("with_control"),]
wilcox_results <- pairwise.wilcox.test(test_dt$lasso_test_cindex_all, test_dt$label, p.adjust.method = "BH",na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
wilcox_results

test_dt=dt[dt$group%in%c("with_controlandreplacement"),]
wilcox_results <- pairwise.wilcox.test(test_dt$lasso_test_cindex_all, test_dt$label, p.adjust.method = "BH",na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
wilcox_results

# test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement"),]
# test_dt$group_new=paste(test_dt$group,test_dt$label,sep = "&")
# wilcox_results <- pairwise.wilcox.test(test_dt$lasso_test_cindex_all, test_dt$group_new, p.adjust.method = "BH",na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
# wilcox_results

#single
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.1wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.2wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.3wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.4wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.5wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.6wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.7wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.8wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("with_replacement","with_controlandreplacement")&dt$label%in%c("m0.9wr"),]
m1<-wilcox.test( test_dt[test_dt$group=="with_replacement","lasso_test_cindex_all"],test_dt[test_dt$group=="with_controlandreplacement","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)

#single
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.1"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.2"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.3"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.4"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.5"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.6"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.7"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.8"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)
test_dt=dt[dt$group%in%c("1","with_control")&dt$label%in%c("m0.9"),]
m1<-wilcox.test( test_dt[test_dt$group=="1","lasso_test_cindex_all"],test_dt[test_dt$group=="with_control","lasso_test_cindex_all"], na.rm=TRUE, paired=FALSE, exact=FALSE, conf.int=TRUE)
print(m1)

```

results show that the different ratio makes a statistically significant difference but not the with and without control. 

## censoring rate stratified sampling
```{r}
load("lasso_ovarian_without.RData")
heatmap_data=data.frame(nrow=18*17,ncol=18)
heatmap_data[1:306,1]=rep(c("bootstrap","c0.1","c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8","m0.1","m0.3","m0.5","m0.7","m0.1wr","m0.3wr","m0.5wr","m0.7wr"),each=18)
heatmap_data[1:306,2]=rep(c("censoring_rate","num_variables","cindex","auc","brier_score","distance_stat","distance_p","censoring_rate_test","distance_stat_test","distance_p_test","lambda","npasses","devratio","cindex_train","brier_score_train","cindex_ex","brier_score_ex","auc_ex"),17)
heatmap_data[1:306,3]=c(other_table(result,current_data2),other_table(result2,current_data2),other_table(result3,current_data2),other_table(result4,current_data2),other_table(result5,current_data2),other_table(result6,current_data2),other_table(result7,current_data2),other_table(result8,current_data2),other_table(result9,current_data2),other_table(result10,current_data2),other_table(result11,current_data2),other_table(result12,current_data2),other_table(result13,current_data2),other_table(result14,current_data2),other_table(result15,current_data2),other_table(result16,current_data2),other_table(result17,current_data2))
colnames(heatmap_data)=c("case","metric","value")
heatmap_data$metric=factor(heatmap_data$metric,levels = c("censoring_rate","num_variables","cindex","auc","brier_score","distance_stat","distance_p","censoring_rate_test","distance_stat_test","distance_p_test","lambda","npasses","devratio","cindex_train","brier_score_train","cindex_ex","brier_score_ex","auc_ex"))

ovarian_censoring=heatmap_data[heatmap_data$case%in%c("c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8"),]
ovarian_censoring_all=heatmap_data[heatmap_data$case%in%c("c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8","bootstrap","m0.3","m0.5","m0.7","m0.3wr","m0.5wr","m0.7wr"),]


heatmap_data=ovarian_censoring
plotdt=heatmap_data[heatmap_data$metric%in%c("cindex_train","brier_score_train","censoring_rate","distance_stat"),]
plotdt_wide=reshape(plotdt,idvar="metric",timevar="case",direction = "wide")
plotdt_wide2=as.data.frame(t(plotdt_wide))
colnames(plotdt_wide2)=plotdt_wide2[1,]
plotdt_wide2=plotdt_wide2[-1,]
plotdt_wide2=apply(plotdt_wide2, 2,as.numeric)
plotdt_wide2=as.data.frame(round(plotdt_wide2,3))
plotdt_wide2$label=c("c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8")
gg=ggplot(plotdt_wide2,aes(x=brier_score_train,y=cindex_train,label=label,color=censoring_rate,size=distance_stat))+geom_point()+geom_text_repel(size=4)+ggtitle("Prediction performances in train")+theme_bw()+geom_line(lwd=0.5)
gg
ggsave("lasso_ovarian_reduced_train.pdf",gg)

plotdt=heatmap_data[heatmap_data$metric%in%c("cindex","brier_score","censoring_rate_test","distance_stat_test"),]
plotdt_wide=reshape(plotdt,idvar="metric",timevar="case",direction = "wide")
plotdt_wide2=as.data.frame(t(plotdt_wide))
colnames(plotdt_wide2)=plotdt_wide2[1,]
plotdt_wide2=plotdt_wide2[-1,]
plotdt_wide2=apply(plotdt_wide2, 2,as.numeric)
plotdt_wide2=as.data.frame(round(plotdt_wide2,3))
plotdt_wide2$label=c("c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8")
gg=ggplot(plotdt_wide2,aes(x=brier_score,y=cindex,label=label,color=censoring_rate_test,size=distance_stat_test))+geom_point()+geom_text_repel(size=4)+ggtitle("Prediction performances in test")+theme_bw()+geom_line(lwd=0.5)
gg
ggsave("lasso_ovarian_reduced_test.pdf",gg)

plotdt=heatmap_data[heatmap_data$metric%in%c("cindex_ex","brier_score_ex"),]
plotdt_wide=reshape(plotdt,idvar="metric",timevar="case",direction = "wide")
plotdt_wide2=as.data.frame(t(plotdt_wide))
colnames(plotdt_wide2)=plotdt_wide2[1,]
plotdt_wide2=plotdt_wide2[-1,]
plotdt_wide2=apply(plotdt_wide2, 2,as.numeric)
plotdt_wide2=as.data.frame(round(plotdt_wide2,3))
plotdt_wide2$label=c("c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8")
gg=ggplot(plotdt_wide2,aes(x=brier_score_ex,y=cindex_ex,label=label))+geom_point()+geom_text_repel(size=4)+ggtitle("Prediction performances in external data")+theme_bw()+geom_line(lwd=0.5)
gg
ggsave("lasso_ovarian_reduced_external.pdf",gg)


heatmap_data=ovarian_censoring_all
plotdt=heatmap_data[heatmap_data$metric%in%c("cindex_train","brier_score_train","censoring_rate","distance_stat"),]
plotdt_wide=reshape(plotdt,idvar="metric",timevar="case",direction = "wide")
plotdt_wide2=as.data.frame(t(plotdt_wide))
colnames(plotdt_wide2)=plotdt_wide2[1,]
plotdt_wide2=plotdt_wide2[-1,]
plotdt_wide2=apply(plotdt_wide2, 2,as.numeric)
plotdt_wide2=as.data.frame(round(plotdt_wide2,3))
plotdt_wide2$label=c("bootstrap","c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8","m0.3","m0.5","m0.7","m0.3wr","m0.5wr","m0.7wr")
gg=ggplot(plotdt_wide2,aes(x=brier_score_train,y=cindex_train,label=label,color=censoring_rate,size=distance_stat))+geom_point()+geom_text_repel(size=4)+ggtitle("Prediction performances in train")+theme_bw()
gg
ggsave("lasso_ovarian_train.pdf",gg)

plotdt=heatmap_data[heatmap_data$metric%in%c("cindex","brier_score","censoring_rate_test","distance_stat_test"),]
plotdt_wide=reshape(plotdt,idvar="metric",timevar="case",direction = "wide")
plotdt_wide2=as.data.frame(t(plotdt_wide))
colnames(plotdt_wide2)=plotdt_wide2[1,]
plotdt_wide2=plotdt_wide2[-1,]
plotdt_wide2=apply(plotdt_wide2, 2,as.numeric)
plotdt_wide2=as.data.frame(round(plotdt_wide2,3))
plotdt_wide2$label=c("bootstrap","c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8","m0.3","m0.5","m0.7","m0.3wr","m0.5wr","m0.7wr")
gg=ggplot(plotdt_wide2,aes(x=brier_score,y=cindex,label=label,color=censoring_rate_test,size=distance_stat_test))+geom_point()+geom_text_repel(size=4)+ggtitle("Prediction performances in test")+theme_bw()
gg
ggsave("lasso_ovarian_test.pdf",gg)

plotdt=heatmap_data[heatmap_data$metric%in%c("cindex_ex","brier_score_ex"),]
plotdt_wide=reshape(plotdt,idvar="metric",timevar="case",direction = "wide")
plotdt_wide2=as.data.frame(t(plotdt_wide))
colnames(plotdt_wide2)=plotdt_wide2[1,]
plotdt_wide2=plotdt_wide2[-1,]
plotdt_wide2=apply(plotdt_wide2, 2,as.numeric)
plotdt_wide2=as.data.frame(round(plotdt_wide2,3))
plotdt_wide2$label=c("bootstrap","c0.2","c0.3","c0.4","c0.5","c0.6","c0.7","c0.8","m0.3","m0.5","m0.7","m0.3wr","m0.5wr","m0.7wr")
gg=ggplot(plotdt_wide2,aes(x=brier_score_ex,y=cindex_ex,label=label))+geom_point()+geom_text_repel(size=4)+ggtitle("Prediction performances in external data")+theme_bw()
gg
ggsave("lasso_ovarian_external.pdf",gg)


```








